<div *ngIf="!showSimpleForm" class="mode-selector">
  <app-double-button
    [changeActiveButtonManually]="true"
    [leftButtonText]="'send.signed-button' | translate"
    [rightButtonText]="'send.unsigned-button' | translate"
    className="light small"
    [activeButton]="!showForManualUnsigned ? doubleButtonActive.LeftButton : doubleButtonActive.RightButton"
    (onStateChange)="changeFormType($event)"
    [ngClass]="{ 'element-disabled': busy }"
  ></app-double-button>
</div>

<div [formGroup]="form">
  <app-form-source-selection
    #formSourceSelection
    (onSelectionChanged)="sourceSelectionChanged()"
    [busy]="busy"
    [selectionMode]="showSimpleForm ? sourceSelectionModes.Wallet : (showForManualUnsigned ? sourceSelectionModes.Manual : sourceSelectionModes.All)"
    >
  </app-form-source-selection>

  <div *ngIf="!showSimpleForm" class="form-field -available-msg">
    <ng-container *ngIf="!availableBalance.loading">
      <span>{{ 'send.available-msg-part1' | translate }}</span>
      <span class="value">
        {{ availableBalance.availableCoins.toString() | amount }}
      </span>
      <span>{{ 'send.available-msg-part2' | translate }}</span>
      <span class="value">
        {{ availableBalance.availableHours.toString() | amount:false }}
      </span>
      <span>{{ 'send.available-msg-part3' | translate }}</span>
      <span class="value">
        {{ availableBalance.minimumFee.toString() | amount:false }}
      </span>
      <span>{{ 'send.available-msg-part4' | translate }}</span>
    </ng-container>
    <ng-container *ngIf="availableBalance.loading">
      <span>{{ 'send.loading-available' | translate }}</span>
    </ng-container>
  </div>

  <app-form-destination
    #formMultipleDestinations
    (onChanges)="multipleDestinationsChanged()"
    (onBulkRequested)="openMultipleDestinationsPopup()"
    [availableBalance]="availableBalance"
    [busy]="busy"
    [showHourFields]="!autoHours"
    [showSimpleForm]="showSimpleForm"
    >
  </app-form-destination>

  <div *ngIf="!showSimpleForm" class="form-field">
    <label for="change-address">
      {{ 'send.change-address-label' | translate }}
      <mat-icon [matTooltip]="'send.change-address-help' | translate">help</mat-icon>
      <span class="-options" (click)="selectChangeAddress($event)" [ngClass]="{'element-disabled' : busy}">
        {{ 'send.change-address-select' | translate }} <mat-icon>keyboard_arrow_down</mat-icon>
      </span>
    </label>
    <input formControlName="changeAddress" id="change-address" (keydown.enter)="showForManualUnsigned ? preview() : null" [attr.disabled]="busy ? 'true' : null">
  </div>

  <div *ngIf="!showForManualUnsigned" class="form-field">
    <label for="note">
      {{ 'send.personal-note-label' | translate }}
      <mat-icon [matTooltip]="'send.personal-note-help' | translate">help</mat-icon>
    </label>
    <input formControlName="note" id="note" (keydown.enter)="preview()" [maxlength]="maxNoteChars" [attr.disabled]="busy ? 'true' : null">
  </div>

  <div *ngIf="!showSimpleForm" class="-autohours" [ngClass]="{'element-disabled' : busy}">
    <div class="row">
      <div class="col-xl-4 col-lg-5 col-md-7">
        <mat-checkbox class="-check" (change)="setAutoHours($event)" [checked]="autoHours" [attr.disabled]="busy ? 'true' : null">
          <div class="-space-between">
            <span>{{ 'send.hours-allocation-label' | translate }}</span>
            <span class="-options" (mousedown)="$event.stopPropagation();" (click)="toggleOptions($event)" *ngIf="autoHours">
              {{ 'send.options-label' | translate }} <mat-icon>{{ autoOptions ? 'keyboard_arrow_up' : 'keyboard_arrow_down' }}</mat-icon>
            </span>
          </div>
        </mat-checkbox>
      </div>
    </div>

    <div [ngClass]="{ 'row -options-wrapper': true, '-hidden': !autoOptions }">
      <div class="col-md-5">
        <div class="form-field">
          <label class="-space-between" for="value">
            <span>
              {{ 'send.value-label' | translate }}
              <mat-icon [matTooltip]="'send.value-help' | translate">help</mat-icon>
            </span>
            <span>{{ autoShareValue | number:'1.0-2' }}</span>
          </label>
          <mat-slider class="-slider" min="0.1" max="1" step="0.01" id="value"
                      (input)="setShareValue($event)" [value]="autoShareValue"
                      [attr.disabled]="busy ? 'true' : null"
          ></mat-slider>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="-buttons">
  <app-button #previewButton (action)="preview()" [disabled]="!form.valid">
    {{ 'send.preview-button' | translate }}
  </app-button>
  <app-button #sendButton (action)="send()" class="primary" [disabled]="!form.valid">
    {{ ('send.' + (showForManualUnsigned ? 'show' : 'send') + '-button') | translate }}
  </app-button>
</div>
